"use strict";document.addEventListener("DOMContentLoaded",function(){var a=document.querySelector(".form");a.addEventListener("submit",function(b){b.preventDefault(),document.getElementById("start_test_btn").setAttribute("disabled","disabled");var c=document.querySelector(".initial-form");c.classList.add("hide_element"),setTimeout(function(){c.classList.add("delete_element")},300);var d=document.querySelector("#user_name").value,e=document.querySelector(".form [name=\"csrfmiddlewaretoken\"]").value,f=a.getAttribute("action"),g={};g.csrfmiddlewaretoken=e,g.user_name=d,$.ajax({url:f,type:"POST",data:g,cache:!0,success:function(h){function k(s,t){var u=0;if("exercises"==s){for(var v of t.nmb_mistakes)0==v&&u++;r.exercises=u+" / "+t.nmb_exercises,m(r),setTimeout(l,500)}else"connection_definition"==s?(r.connection_definition=t+" / "+t,n("exercises")?setTimeout(q,1e3):(m(r),setTimeout(l,500))):"tests"==s&&(r.test=t.nmb_correct_test+" / "+t.nmb_test,n("connections_definition")?setTimeout(p,1e3):n("exercises")?setTimeout(q,1e3):(m(r),setTimeout(l,500)))}function l(){document.getElementById("results").classList.remove("delete_element");var s=document.querySelector("#results .table").rows[1].cells,t=1;for(var u in r)s[t].innerHTML=r[u],t++}function m(s){var t=document.querySelector("#hidden_form input[name=\"csrfmiddlewaretoken\"]").value,u=document.querySelector("#hidden_form").getAttribute("action"),v={test:s.test,connection_definition:s.connection_definition,exercises:s.exercises,csrfmiddlewaretoken:t};$.ajax({url:u,type:"POST",data:v,cache:!0,error:function(){console.log("Error connection with db denied")}})}function n(s){return h.hasOwnProperty(s)}function o(){function t(){var M=B.questions[C-1],N=B.answers[C-1];J.innerHTML="\u0422\u0435\u0441\u0442: "+C+"/"+D,K.innerHTML=M;for(var O=0;4>O;O++)I[O].innerHTML=N[O]}function u(){F.classList.toggle("show_element"),G.classList.toggle("show_element"),H.classList.toggle("show_test_block")}function v(M,N){var O=M.getAttribute("data-answer");return parseInt(O)===N?(E.nmb_correct_test++,1):0}function w(M){var N=B.correct_answers[C-1],O=v(M.target,N);1==O?M.target.classList.replace("list-group-item-light","list-group-item-success"):(H.children[N-1].classList.replace("list-group-item-light","list-group-item-success"),M.target.classList.replace("list-group-item-light","list-group-item-danger")),z();for(var P=0;4>P;P++)I[P].removeEventListener("click",w)}function z(){L.firstElementChild.removeAttribute("disabled"),L.classList.toggle("hide_element"),L.addEventListener("click",A)}function A(){if(C++,L.firstElementChild.setAttribute("disabled","disabled"),L.classList.toggle("hide_element"),u(),C<=D){setTimeout(t,800),setTimeout(u,800);for(var M=0;4>M;M++)I[M].addEventListener("click",w),I[M].classList="list-group-item list-group-item-action list-group-item-light"}else setTimeout(function(){document.querySelector("#test_block").classList.toggle("delete_element")},800),k("tests",E);L.removeEventListener("click",A)}var B=h.tests,C=1,D=B.correct_answers.length,E={nmb_correct_test:0,nmb_test:D},F=document.querySelector("#test_block .progress_task"),G=document.querySelector("#test_block .condition"),H=document.querySelector("#test_block .list-group"),I=document.querySelectorAll("#test_block .list-group a"),J=document.querySelector("#test_block .progress_task p"),K=document.querySelector(".condition h3"),L=document.querySelector("#test_block .next-test-btn");(function(){document.querySelector("#test_block").classList.toggle("delete_element"),t(),setTimeout(u,300);for(var M=0;4>M;M++)I[M].addEventListener("click",w)})()}function p(){function s(V,W){var X=V.getAttribute("data-definition"),Y=W.getAttribute("data-dropzone");return!(X!==Y)}function t(V,W){V.classList.remove("draggable"),W.classList.remove("dropzone")}function u(V,W){var X=V.getBoundingClientRect(),Y=W.getBoundingClientRect();W.style.left=X.left-Y.left+"px",W.style.top=X.top-Y.top+"px"}function w(){U.firstElementChild.removeAttribute("disabled"),U.classList.remove("hide_element"),U.addEventListener("click",z)}function z(){H++,K.value=0;var V=H+1;D(),U.firstElementChild.setAttribute("disabled","disabled"),U.classList.add("hide_element"),V<=I?(setTimeout(C,1e3),setTimeout(B,1e3),setTimeout(A,1e3)):(setTimeout(function(){L.classList.add("delete_element")},1e3),k("connection_definition",I))}function A(){M.classList.add("show_element"),N.classList.add("show_element"),O.style.left="0",Q.style.opacity="1",S.style.right="0"}function B(){document.querySelector("#connection_definition .progress_task p").innerHTML="\u0417\u0430\u0432\u0434\u0430\u043D\u043D\u044F: "+(H+1)+"/"+I;var V=[];for(var W in G[H])V.push(W);var X=[];for(var Y of V)X.push(Y.slice(-1));for(var Z=0;4>Z;Z++)P[Z].innerHTML=F[H][Z],T[Z].innerHTML=G[H][V[Z]],T[Z].setAttribute("data-definition",X[Z])}function C(){for(var V of T)V.style.transform="translate( 0, 0)",V.setAttribute("data-x",0),V.setAttribute("data-y",0),V.style.left=0,V.style.top=0,V.classList.add("draggable");for(var W of R)W.classList.add("dropzone")}function D(){M.classList.remove("show_element"),N.classList.remove("show_element"),O.style.left="-100%",Q.style.opacity="0",S.style.right="-100%"}var E=h.connections_definition,F=E.concepts,G=E.definitions,H=0,I=F.length,K={value:0},L=document.querySelector("#connection_definition"),M=document.querySelector("#connection_definition .progress_task"),N=document.querySelector("#connection_definition .condition"),O=document.querySelector("#connection_definition #concepts_block"),P=document.querySelectorAll("#connection_definition #concepts_block li"),Q=document.querySelector("#connection_definition #dropzones_block"),R=document.querySelectorAll("#connection_definition #dropzones_block li"),S=document.querySelector("#connection_definition #definition_block"),T=document.querySelectorAll("#connection_definition #definition_block li"),U=document.querySelector("#connection_definition .next-test-btn");L.classList.remove("delete_element"),interact(".dropzone").dropzone({accept:{id:"#drop-1,#drop-2,#drop-3,#drop-4"}.id,overlap:0.25,ondropactivate:function(V){V.target.classList.add("drop-active")},ondragenter:function(V){var W=V.relatedTarget,X=V.target;s(W,X)?X.classList.add("drop-target"):X.classList.add("cant-drop")},ondragleave:function(V){V.target.classList.remove("drop-target"),V.relatedTarget.classList.remove("can-drop"),V.target.classList.remove("cant-drop")},ondrop:function(V){var W=V.relatedTarget,X=V.target;s(W,X)?(K.value++,t(W,X),u(X,W),4===K.value&&w()):(X.classList.remove("cant-drop"),W.style.transform="translate( 0, 0)",W.setAttribute("data-x",0),W.setAttribute("data-y",0))},ondropdeactivate:function(V){V.target.classList.remove("drop-active"),V.target.classList.remove("drop-target")}}),interact(".draggable").draggable({inertia:!0,restrict:{restriction:".connection_block",endOnly:!0,elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onmove:function(V){var W=V.target,X=(parseFloat(W.getAttribute("data-x"))||0)+V.dx,Y=(parseFloat(W.getAttribute("data-y"))||0)+V.dy;W.style.webkitTransform=W.style.transform="translate("+X+"px, "+Y+"px)",W.setAttribute("data-x",X),W.setAttribute("data-y",Y)}}),setTimeout(A,500),B()}function q(){function s(){H.nmb_mistakes.push(F.nmb_mistakes),F.current_task+=1,F.nmb_mistakes=0,u(),K.classList.remove("show_hint_container"),P.firstElementChild.setAttribute("disabled","disabled"),P.classList.add("hide_element"),F.current_task<G?(setTimeout(v,500),setTimeout(t,500),setTimeout(u,500)):(setTimeout(function(){I.classList.add("delete_element")},500),k("exercises",H))}function t(){document.querySelector(".hint_container .btn").classList.add("collapsed"),document.querySelector(".hint_container .collapse").classList.remove("show"),N.removeAttribute("disabled"),O.removeAttribute("disabled"),N.classList.remove("is-valid"),N.value=""}function u(){J.classList.toggle("progress_task"),L.classList.toggle("condition"),M.classList.toggle("show_answer_container")}function v(){I.firstElementChild.innerHTML="\u0417\u0430\u0434\u0430\u0447\u0430 "+(F.current_task+1)+"/"+G,document.querySelector("#exercises .condition_block div h3").innerHTML=B.titles[F.current_task],document.querySelector("#exercises .condition_block div h4").innerHTML=B.conditions[F.current_task]}function w(){K.classList.toggle("show_hint_container")}function z(){M.removeEventListener("transitionend",z),O.addEventListener("click",A)}function A(Q){var R=parseFloat(C[F.current_task].toFixed(2)),S=parseFloat(parseFloat(N.value).toFixed(2));isNaN(S)||(Q.preventDefault(),R+0.1>=S&&S>=R-0.1?(N.classList.remove("is-invalid"),N.classList.add("is-valid"),N.setAttribute("disabled","disabled"),O.setAttribute("disabled","disabled"),P.firstElementChild.removeAttribute("disabled"),P.classList.remove("hide_element"),P.addEventListener("click",s)):(F.nmb_mistakes+=1,N.classList.add("is-invalid"),1==F.nmb_mistakes&&(document.querySelector("#exercises .card").innerHTML=D[F.current_task],w()),2==F.nmb_mistakes&&(document.querySelector(".hint_container .btn").classList.add("collapsed"),document.querySelector(".hint_container .collapse").classList.remove("show"),document.querySelector("#exercises .card").innerHTML=E[F.current_task])))}var B=h.exercises,C=B.correct_answers,D=B.hints,E=B.resolving_hints,F={current_task:0,nmb_mistakes:0},G=B.titles.length,H={nmb_mistakes:[],nmb_exercises:G},I=document.querySelector("#exercises"),J=document.querySelector("#exercises .progress_block"),K=document.querySelector("#exercises .hint_container"),L=document.querySelector("#exercises .condition_block"),M=document.querySelector("#exercises .answer_container"),N=document.getElementById("answer"),O=document.querySelector("#exercises .input-group .btn"),P=document.querySelector("#exercises .next-test-btn");I.classList.remove("delete_element"),setTimeout(u,50),v(),M.addEventListener("transitionend",z)}var r={test:"0 / 0",connection_definition:"0 / 0",exercises:"0 / 0"};setTimeout(function(){h.hasOwnProperty("Not enough data in db")?document.getElementById("error").classList.remove("delete_element"):n("tests")?o():n("connections_definition")?p():q()},500)},error:function(){console.log("Error")}})})});